var userId="686b6d35521bcfdc9852b4dd";const getUserIp=async()=>{try{const e=await fetch("https://api.ipify.org?format=json");if(e.ok){const t=await e.json();return t?.ip}throw new Error("Failed to fetch IP")}catch(e){return console.error("Error fetching IP:",e),null}};function setCookie(e,t,n){const o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);const i="expires="+o.toUTCString(),r="https:"===location.protocol?"; secure":"";document.cookie=e+"="+encodeURIComponent(t)+"; "+i+"; SameSite=Lax"+r+"; path=/"}function getCookie(e){const t=e+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let o=n[e];for(;" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(t))return decodeURIComponent(o.substring(t.length))}return null}function parseUrlParameters(e){const t={};try{const n=e.split("?")[1];if(!n)return t;const o=new URLSearchParams(n);for(let e of o.entries())t[e[0]]=e[1]}catch(e){console.error("Error parsing URL parameters:",e)}return t}function generateRandomUniqueID(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function generateUniqueUserID(){const e="visitorId",t=getCookie(e);if(t)return t;const n=generateRandomUniqueID();return setCookie(e,n,365),n}function getLandingPage(){const e=getCookie("urlpt_landing_page");if(!e){const e=window.location.href;return setCookie("urlpt_landing_page",e,365),e}return e}function getGaClientId(){try{const e=document.cookie.split(";").find((e=>e.trim().startsWith("_ga=")));if(e)return e.split(".").slice(-2).join(".")}catch(e){console.error("Error getting GA client ID:",e)}return null}function getFacebookIds(){return{fbc:getCookie("_fbc"),fbp:getCookie("_fbp")}}function getUserDeviceInfo(){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),n=/Tablet|iPad/i.test(e),o=/TV/i.test(e),i=/Macintosh|MacIntel|MacPPC|Mac68K/i.test(e),r=/Win32|Win64|Windows|WinCE/i.test(e),a=/Linux/i.test(e)&&!t;let s="Desktop",c="Unknown",l="Unknown";if(t)if(s="Mobile",/Android/i.test(e)){c="Android";const t=e.match(/Android.*?;s([^;)]*)/i);t&&t[1]&&(l=t[1].trim())}else/iPhone|iPod/i.test(e)?(c="iOS",l=/iPhone/i.test(e)?"iPhone":"iPod"):/Windows Phone/i.test(e)&&(c="Windows Phone");else n?(s="Tablet",/iPad/i.test(e)?(c="iOS",l="iPad"):/Android/i.test(e)&&(c="Android",l="Android Tablet")):o?s="TV":i?c="MacOS":r?c="Windows":a&&(c="Linux");let u="Unknown";return/Edge/i.test(e)?u="Edge":/OPR|Opera/i.test(e)?u="Opera":/Chrome/i.test(e)&&!/Chromium|Edge|OPR|Opera/i.test(e)?u="Chrome":/Firefox/i.test(e)?u="Firefox":/Safari/i.test(e)&&!/Chrome|Chromium|Edge|OPR|Opera/i.test(e)?u="Safari":/MSIE|Trident/i.test(e)&&(u="Internet Explorer"),{screenWidth:window.screen.width,screenHeight:window.screen.height,deviceType:s,deviceModel:l,os:c,browser:u,language:navigator.language||navigator.userLanguage,colorDepth:window.screen.colorDepth,pixelRatio:window.devicePixelRatio||1,touchScreen:"ontouchstart"in window||navigator.maxTouchPoints>0,userAgent:e}}function extractUrlInfo(){const e=document.referrer;try{if(!e)return{base:null,domain:null};const t=new URL(e);return{refUrl:e,base:t.origin,domain:t.hostname}}catch(e){return console.error("Error extracting URL info:",e),{base:null,domain:null}}}function getAllUtmParameters(){const e=new URLSearchParams(window.location.search),t={};["utm_source","utm_medium","utm_campaign","utm_term","utm_content","utm_device","utm_devicemodel"].forEach((n=>{const o=e.get(n);o&&(t[n]=o)}));return["fbclid","msclkid","gclid"].forEach((n=>{const o=e.get(n);o&&(t[n]=o)})),t}function storeFirstTouchUtm(){const e=getAllUtmParameters();Object.entries(e).forEach((([e,t])=>{if(e.startsWith("utm_")){const n="first_"+e;!getCookie(n)&&t&&setCookie(n,t,365)}})),["fbclid","msclkid","gclid"].forEach((t=>{e[t]&&!getCookie("first_"+t)&&setCookie("first_"+t,e[t],365)}))}function getFirstTouchUtm(){const e={};return["utm_source","utm_medium","utm_campaign","utm_term","utm_content","fbclid","msclkid","gclid"].forEach((t=>{const n="first_"+t,o=getCookie(n);o&&(e[n]=o)})),e}function collectUserProvidedData(){return{email:getCookie("email")||null,fname:getCookie("fname")||null,phone:getCookie("phone")||null}}function storeUserProvidedData(e,t,n){e&&setCookie("email",e,365),t&&setCookie("fname",t,365),n&&setCookie("phone",n,365)}function getSessionDuration(){const e=getCookie("sessionStart");return e?Math.floor(((new Date).getTime()-parseInt(e))/1e3):(setCookie("sessionStart",(new Date).getTime(),1),0)}function trackPageEngagement(){let e=0,t=0,n=0,o=new Date;window.addEventListener("scroll",(()=>{const n=window.innerHeight,o=document.documentElement.scrollHeight,i=window.scrollY;e=Math.floor((i+n)/o*100),t=Math.max(t,e)})),document.addEventListener("click",(e=>{const t=e.target,n="A"===t.tagName||t.closest("a"),o="BUTTON"===t.tagName||t.closest("button");updateInteractions("click",{element:n?"link":o?"button":t.tagName.toLowerCase(),text:t.textContent?.trim().substring(0,50)||null,timestamp:(new Date).toISOString(),position:{x:e.pageX,y:e.pageY}})})),document.addEventListener("submit",(e=>{const t=e.target;let n=null,o=null,i=null;for(let e=0;e<t.elements.length;e++){const r=t.elements[e];r.name&&r.value&&((r.name.toLowerCase().includes("email")||"email"===r.type)&&(n=r.value),(r.name.toLowerCase().includes("name")||r.name.toLowerCase().includes("fname")||r.name.toLowerCase().includes("firstname"))&&(o=r.value),(r.name.toLowerCase().includes("phone")||r.name.toLowerCase().includes("tel")||"tel"===r.type)&&(i=r.value))}(n||o||i)&&storeUserProvidedData(n,o,i);updateInteractions("form_submit",{formId:t.id||null,formClass:t.className||null,formElements:t.elements.length,hasPersonalData:!!(n||o||i),timestamp:(new Date).toISOString()})})),window.addEventListener("beforeunload",(()=>{n=Math.floor((new Date-o)/1e3);updateInteractions("page_exit",{timeOnPage:n,maxScrollDepth:t,timestamp:(new Date).toISOString()}),updateUserCookieWithInteractions(getInteractions())})),setInterval((()=>{n=Math.floor((new Date-o)/1e3);updateInteractions("periodic_update",{timeOnPage:n,maxScrollDepth:t,timestamp:(new Date).toISOString()}),updateUserCookieWithInteractions(getInteractions())}),6e4)}let interactionsArray=[];function updateInteractions(e,t){interactionsArray.push({type:e,data:t,url:window.location.href,timestamp:(new Date).toISOString()}),interactionsArray.length>50&&(interactionsArray=interactionsArray.slice(-50))}function getInteractions(){return interactionsArray}function updateUserCookieWithInteractions(e){const t=getCookie("userCookie");if(t)try{const n=JSON.parse(t);n.lastSeen=(new Date).toISOString(),n.urlpt_url=window.location.href,n.sessionDuration=getSessionDuration(),n.interactions=e;const o=collectUserProvidedData();return o.email&&(n.email=o.email),o.fname&&(n.fname=o.fname),o.phone&&(n.phone=o.phone),setCookie("userCookie",JSON.stringify(n),365),n}catch(e){console.error("Error updating user cookie:",e)}}async function postUserDataToServer(e){console.log("newClientId: ",userId);const t=updateUserCookieWithInteractions(getInteractions());e={...e,...t,clientId:void 0!==userId?userId:null,new:!0},console.log("userData: ",e);try{const t=await fetch("https://urlptapi.technians.in/api/visitors/add-visitors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`Server responded with status ${t.status}`);const n=await t.json();return console.log("Data posted successfully:",n),n}catch(e){console.error("Error posting data to server",e)}}function getOriginalRef(){const e=getCookie("urlpt_original_ref");return!e&&document.referrer?(setCookie("urlpt_original_ref",document.referrer,365),document.referrer):e}function get_url_domain(e){let t=document.createElement("a");return t.href=e,t.hostname}function getUrlVars(){var e={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(t,n,o){e[n]=decodeURIComponent(o)})),e}function getTrafficDetails(){var e=getUrlVars();let t="Other";const n=""==document.referrer?"":this.get_url_domain(document.referrer);let o=document.location.host;""==n?t="Direct":null!==n.match(/google/i)?t="Google":null!==n.match(/yahoo/i)?t="Yahoo":null!==n.match(/bing/i)?t="Bing":null!==n.match(/instagram/i)?t="Instagram":null!==n.match(/facebook/i)||null!==n.match(/fb.com$/i)?t="Facebook":null!==n.match(/twitter/i)||null!==n.match(/t.co$/i)?t="Twitter":null!==n.match(/snapchat/i)?t="Snapchat":null!==n.match(/youtube/i)?t="YouTube":null!==n.match(/pinterest/i)?t="Pinterest":null!==n.match(/linkedin/i)?t="LinkedIn":null!==n.match(/tumblr/i)?t="Tumblr":null!==n.match(/duckduckgo/i)?t="Duckduckgo":o==n&&(t="Internal");let i="Other";-1!=Object.keys(e).indexOf("gclid")||-1!=Object.keys(e).indexOf("msclkid")||null!=getCookie("fbclid")&&null!=getCookie("_fbc")||-1!=Object.keys(e).indexOf("fbclid")&&null!=getCookie("_fbc")?i="Paid":["Google","Bing","Yahoo","Duckduckgo"].indexOf(t)>-1?i="Organic":["Facebook","Twitter","Instagram","Snapchat","YouTube","Pinterest","LinkedIn","Tumblr"].indexOf(t)>-1?i="Social":["Internal","Direct"].indexOf(t)>-1?i="Direct":t&&-1==["Internal"].indexOf(t)&&(i="Referral");let r=getCookie("first_traffic_source");r||(setCookie("first_traffic_source",i,365),r=i);const a={trafficSource:i,firstTrafficSource:r};return"Organic"===i?(a.organicSourceStr=t,a.organicSource=document.referrer):(a.organicSourceStr=null,a.organicSource=null),a}async function initializeTracking(){try{storeFirstTouchUtm();const e=await getUserIp(),t=getUserDeviceInfo(),n=(extractUrlInfo(window.location.href),getCookie("userCookie")),o=(new Date).getTime();setCookie("visitId",o,365);const i=getAllUtmParameters(),r=getFirstTouchUtm(),a=getFacebookIds(),s=collectUserProvidedData(),c=getTrafficDetails(),l={urlpt_ip:e,visitorId:generateUniqueUserID(),visitId:o,gaclientid:getGaClientId(),utm_source:i.utm_source||null,utm_medium:i.utm_medium||null,utm_campaign:i.utm_campaign||null,utm_term:i.utm_term||null,utm_content:i.utm_content||null,first_utm_source:r.first_utm_source||null,first_utm_medium:r.first_utm_medium||null,first_utm_campaign:r.first_utm_campaign||null,first_utm_term:r.first_utm_term||null,first_utm_content:r.first_utm_content||null,fbclid:i.fbclid||null,msclkid:i.msclkid||null,gclid:i.gclid||null,urlpt_original_ref:getOriginalRef(),urlpt_landing_page:getLandingPage(),urlpt_landing_page_base:new URL(getLandingPage()).origin,urlpt_ref:document.referrer,urlpt_ref_domain:""==document.referrer?"":this.get_url_domain(document.referrer),urlpt_url:document.location.href,urlpt_url_base:document.location.hostname+document.location.pathname,domain:document.location.hostname,traffic_source:c.trafficSource,first_traffic_source:c.firstTrafficSource,organic_source:c.organicSource,organic_source_str:c.organicSourceStr,email:s.email,fname:s.fname,phone:s.phone,user_agent:t.userAgent,deviceInfo:t,utm_device:t.deviceType,utm_devicemodel:t.deviceModel,_fbc:a.fbc,_fbp:a.fbp,firstSeen:n?JSON.parse(n).firstSeen:(new Date).toISOString(),lastSeen:(new Date).toISOString(),sessionDuration:getSessionDuration(),sessionCount:parseInt(getCookie("sessionCount")||"0")+1,interactions:[]};setCookie("userCookie",JSON.stringify(l),365),setCookie("sessionCount",l.sessionCount.toString(),365),postUserDataToServer(l),trackPageEngagement(),console.log("Tracking initialized successfully")}catch(e){console.error("Error initializing tracking:",e)}}initializeTracking();